{"version":2,"kind":"Notebook","sha256":"c6f8c7f92736bf35bb160d4f007a3f1f80199d0cb1b2feefdc93cee4365756e3","slug":"projects.bnf-2025.acid.ccn-droplet-count","location":"/projects/bnf-2025/acid/ccn-droplet-count.ipynb","dependencies":[],"frontmatter":{"title":"Cloud Condensation Nuclei and Precipitation Analysis","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Max Grover","given":"Max","family":"Grover"},"name":"Max Grover","orcid":"0000-0002-0370-8974","github":"mgrover1","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/mgrover1/arm-field-site-cookbook","copyright":"2025","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"numbering":{"title":{"offset":3}},"edit_url":"https://github.com/mgrover1/arm-field-site-cookbook/blob/main/projects/bnf-2025/acid/ccn-droplet-count.ipynb","thumbnail":"/arm-field-site-cookbook/build/33705c75de1c0997e47bdf15c5b51f4c.jpeg","exports":[{"format":"ipynb","filename":"ccn-droplet-count.ipynb","url":"/arm-field-site-cookbook/build/ccn-droplet-count-a31c63c4510053ecc0e64f07c4504da8.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"image","style":{"height":"300px"},"url":"/arm-field-site-cookbook/build/33705c75de1c0997e47bdf15c5b51f4c.jpeg","alt":"BNF Instruments","key":"xiCmOzNbQe","urlSource":"https://www.arm.gov/uploads/53943128233_e595b5afeb_c.jpg"}],"key":"JhWaYYDHJb"}],"key":"YvPBUspRYt"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Cloud Condensation Nuclei and Precipitation Analysis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dflYI3uJGy"}],"identifier":"cloud-condensation-nuclei-and-precipitation-analysis","label":"Cloud Condensation Nuclei and Precipitation Analysis","html_id":"cloud-condensation-nuclei-and-precipitation-analysis","implicit":true,"key":"O2LZ3dG8RX"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Example shows how to plot up CCN droplet count\nin a size distribution plot, and an interactive precipitation intensity visualization.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"drLF3leC09"}],"key":"DNzHDympTh"}],"key":"i9v7VCd7KF"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ru1XdWwJQ9"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"NRXm86qbqC"}],"key":"oDWt23FXrg"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport act\nimport matplotlib.pyplot as plt\nimport plotly.graph_objects as go","key":"Fh5Jye6ZBQ"},{"type":"output","id":"rdzSM0Ro4qwECt8xw1P2s","data":[],"key":"zbdsAOiEP7"}],"key":"ykZuf4a4UJ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Analyze CCN Data for BNF from the Data Archive","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ftM10gXB5d"}],"identifier":"analyze-ccn-data-for-bnf-from-the-data-archive","label":"Analyze CCN Data for BNF from the Data Archive","html_id":"analyze-ccn-data-for-bnf-from-the-data-archive","implicit":true,"key":"VHI17PdxAq"}],"key":"uyI5V2hLo9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"username = 'mgrover4'\ntoken = '176e1559b67be630'\ndatastream = 'bnfaosccn2colaspectraM1.b1'\nstartdate = '2025-05-08'\nenddate = '2025-05-11T23:59:59'","key":"SMq6R9UP7o"},{"type":"output","id":"Oy2Mt8LaT_3EG7cXZUlaI","data":[],"key":"eZc3lvq06d"}],"key":"IfgI2Syzqi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Download and read the data\nresult_ccn = act.discovery.download_arm_data(username, token, datastream, startdate, enddate)\nds_ccn = act.io.read_arm_netcdf(result_ccn)\nds_ccn.clean.cleanup()","key":"a9Pdgjw9oV"},{"type":"output","id":"-tD5T1uOEW0_95D4VZGS5","data":[{"output_type":"stream","name":"stdout","text":"[DOWNLOADING] bnfaosccn2colaspectraM1.b1.20250508.010251.nc\n"},{"output_type":"stream","name":"stdout","text":"[DOWNLOADING] bnfaosccn2colaspectraM1.b1.20250509.000954.nc\n"},{"output_type":"stream","name":"stdout","text":"[DOWNLOADING] bnfaosccn2colaspectraM1.b1.20250510.002958.nc\n[DOWNLOADING] bnfaosccn2colaspectraM1.b1.20250511.005002.nc\n\nIf you use these data to prepare a publication, please cite:\n\nKoontz, A., Uin, J., Andrews, E., Enekwizu, O., Hayes, C., & Salwen, C. Cloud\nCondensation Nuclei Particle Counter (AOSCCN2COLASPECTRA), 2025-05-08 to\n2025-05-11, Bankhead National Forest, AL, USA; Long-term Mobile Facility (BNF),\nBankhead National Forest, AL, AMF3 (Main Site) (M1). Atmospheric Radiation\nMeasurement (ARM) User Facility. https://doi.org/10.5439/1323896\n\n"}],"key":"b7IuZ3M3xC"}],"key":"Eby2HmiAhW"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualize the CCN Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YrJw9d8W1T"}],"identifier":"visualize-the-ccn-data","label":"Visualize the CCN Data","html_id":"visualize-the-ccn-data","implicit":true,"key":"gRt2go0nyJ"}],"key":"TYk6zzZU0e"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"if 'lat' not in ds_ccn.coords:\n    ds_ccn = ds_ccn.set_coords(['lat', 'lon'])\n\nprint(\"Variables:\", list(ds_ccn.data_vars))\n\nccn_var = 'concentration'\n\n# Plot\ndisp = act.plotting.TimeSeriesDisplay(ds_ccn, figsize=(12, 8))\ndisp.plot(ccn_var, label='CCN Concentration [#/cm³]')\ndisp.axes[0].set_title('Cloud Condensation Nuclei (CCN) Number Concentration')\ndisp.axes[0].set_ylabel('Supersaturation (%)')\ndisp.axes[0].set_xlabel('Time (UTC)')\ndisp.day_night_background()\ndisp.axes[0].legend()\n\nplt.show()","key":"E9kaBzNtkz"},{"type":"output","id":"7wdnqNF_3pCzXeB2Cl1ac","data":[{"output_type":"stream","name":"stdout","text":"Variables: ['base_time', 'time_offset', 'time_bounds', 'setpoint_time', 'supersaturation_calculated', 'N_CCN', 'qc_N_CCN', 'N_CCN_fit_coefs', 'N_CCN_fit_error', 'N_CCN_fit_value', 'concentration', 'f_CCN', 'qc_f_CCN', 'alt']\n"},{"output_type":"stream","name":"stderr","text":"/tmp/ipykernel_4091/132956031.py:15: UserWarning: Legend does not support handles for QuadMesh instances.\nSee: https://matplotlib.org/stable/tutorials/intermediate/legend_guide.html#implementing-a-custom-legend-handler\n  disp.axes[0].legend()\n/tmp/ipykernel_4091/132956031.py:15: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.\n  disp.axes[0].legend()\n"},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1200x800 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"bb4219d686767a9a842fd469752a27a1","path":"/arm-field-site-cookbook/build/bb4219d686767a9a842fd469752a27a1.png"}}}],"key":"Nd5nk4yW6H"}],"key":"wFrKDunjay"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#Get supersaturation levels and time\nsupersat = ds_ccn['supersaturation_setpoint'].values\ntimes = ds_ccn['time'].values\n\n#Create the plot\nfig, ax = plt.subplots(figsize=(12, 5))\ncolors = plt.cm.viridis(np.linspace(0, 1, len(supersat)))\n\n#Plot one trace per supersaturation level\nfor i, ss in enumerate(supersat):\n    ccn = ds_ccn['concentration'].sel(supersaturation_setpoint=ss)\n    valid = ~ccn.isnull()\n    ax.scatter(times[valid], ccn.values[valid], s=10, color=colors[i], label=f'SS = {ss:.2f}')\n\n#Plot makeup\nax.set_title('CCN Number Concentration vs Time at Different Supersaturations')\nax.set_xlabel('Time (UTC)')\nax.set_ylabel('CCN Concentration [#/cm³]')\nax.set_yscale('log')\nax.legend(title='Supersaturation (%)')\nax.grid(True)\nplt.tight_layout()\nplt.show()","key":"vfo1Mg6HAS"},{"type":"output","id":"_AVvyjatwsg5M7e_X5iay","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1200x500 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"8a6db7ced2ec036f7b225fa968ae58dd","path":"/arm-field-site-cookbook/build/8a6db7ced2ec036f7b225fa968ae58dd.png"}}}],"key":"OwGRAirOuD"}],"key":"czuf1Qqyil"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Precipitation Analysis with the Pluvio","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bd4HTHzX8O"}],"identifier":"precipitation-analysis-with-the-pluvio","label":"Precipitation Analysis with the Pluvio","html_id":"precipitation-analysis-with-the-pluvio","implicit":true,"key":"SJyt8mo7yE"}],"key":"HuefwfNlJX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Set the datastream and start/enddates\ndatastream = 'bnfwbpluvio2M1.a1'\nstartdate = '2025-05-08'\nenddate = '2025-05-11T23:59:59'","key":"FoqTzSVfNV"},{"type":"output","id":"uHR7eFRD9GpkUCir2FAoL","data":[],"key":"rFh9iQFqat"}],"key":"yAELKn7Dbp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Use ACT to easily download the data.  Watch for the data citation!  Show some support\n# for ARM's instrument experts and cite their data if you use it in a publication\nresult_rain = act.discovery.download_arm_data(username, token, datastream, startdate, enddate)\n\n# Let's read in the data using ACT and check out the data\nds_rain = act.io.read_arm_netcdf(result_rain)\n\n# Apply quality control checks\nds_rain.clean.cleanup()","key":"EabsAl2hpy"},{"type":"output","id":"mAc2E8Udez66ybHDuygzw","data":[{"output_type":"stream","name":"stdout","text":"[DOWNLOADING] bnfwbpluvio2M1.a1.20250508.000000.nc\n[DOWNLOADING] bnfwbpluvio2M1.a1.20250509.000000.nc\n"},{"output_type":"stream","name":"stdout","text":"[DOWNLOADING] bnfwbpluvio2M1.a1.20250510.000000.nc\n[DOWNLOADING] bnfwbpluvio2M1.a1.20250511.000000.nc\n"},{"output_type":"stream","name":"stdout","text":"\nIf you use these data to prepare a publication, please cite:\n\nZhu, Z., Wang, D., Jane, M., Cromwell, E., Sturm, M., Irving, K., & Delamere, J.\nWeighing Bucket Precipitation Gauge (WBPLUVIO2), 2025-05-08 to 2025-05-11,\nBankhead National Forest, AL, USA; Long-term Mobile Facility (BNF), Bankhead\nNational Forest, AL, AMF3 (Main Site) (M1). Atmospheric Radiation Measurement\n(ARM) User Facility. https://doi.org/10.5439/1338194\n\n"}],"key":"YaV7xIJRGK"}],"key":"B0bv7n0DoI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#printing output label\nprint(\"Available rain-related variables:\")\n#printing list of variables\nprint(list(ds_rain.data_vars))\n#saving rain variables\nrain_rate_var = 'intensity_rt'\n#giving a shortcut\nds = ds_rain","key":"QIwy4EM2D4"},{"type":"output","id":"TWWYKalHPV2nRl517KPPQ","data":[{"output_type":"stream","name":"stdout","text":"Available rain-related variables:\n['base_time', 'time_offset', 'intensity_rt', 'accum_rtnrt', 'accum_nrt', 'accum_total_nrt', 'bucket_rt', 'bucket_nrt', 'load_cell_temp', 'heater_status', 'pluvio_status', 'elec_unit_temp', 'supply_volts', 'orifice_temp', 'maintenance_flag', 'reset_flag', 'volt_min', 'ptemp', 'intensity_rtnrt', 'lat', 'lon', 'alt']\n"}],"key":"rBLlQEKUvE"}],"key":"FTqA5F45IX"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Interactive Visualizion of the Pluvio Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ORztQB838d"}],"identifier":"interactive-visualizion-of-the-pluvio-data","label":"Interactive Visualizion of the Pluvio Data","html_id":"interactive-visualizion-of-the-pluvio-data","implicit":true,"key":"dPfpl6CWlT"}],"key":"npuRoODYiQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#store data\nrain_rate_var = 'intensity_rt'\ndf_rain = ds_rain[rain_rate_var].to_dataframe().dropna()\n\nfig = go.Figure()\n\nfig.add_trace(go.Scatter(\n    x=df_rain.index,\n    y=df_rain[rain_rate_var],\n    mode='lines+markers',\n    name='Rain Rate [mm/hr]',\n    line=dict(color='blue')\n))\n\nfig.update_layout(\n    title='Rain Rate (Pluvio2)',\n    xaxis_title='Time (UTC)',\n    yaxis_title='Rain Rate [mm/hr]',\n    hovermode='x unified',\n    template='plotly_white',\n    height=500,\n)\n\nfig.show()","key":"IGW3tpRDB7"},{"type":"output","id":"njrcCjlR7UCIrmveUgFy4","data":[{"output_type":"display_data","metadata":{},"data":{"application/vnd.plotly.v1+json":{"content_type":"application/vnd.plotly.v1+json","hash":"4ed152a5122ffa00ccd27efe846f8c37","path":"/arm-field-site-cookbook/build/4ed152a5122ffa00ccd27efe846f8c37.json"}}}],"key":"aSB52NH5RJ"}],"key":"qGyQINACMZ"}],"key":"Cuh8yULVk6"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Coldpool and Downdraft Analysis","url":"/projects/bnf-2025/bnf-deep-convection/coldpool-time-series","group":"BNF Deep Convection"},"next":{"title":"Aerosol Optical Properties at BNF","url":"/projects/bnf-2025/acid/optical-properties","group":"Aerosol Cloud Interactions Deposition (ACID)"}}},"domain":"http://localhost:3000"}
{"version":2,"kind":"Notebook","sha256":"c6f8c7f92736bf35bb160d4f007a3f1f80199d0cb1b2feefdc93cee4365756e3","slug":"projects.bnf-2025.acid.ccn-droplet-count","location":"/projects/bnf-2025/acid/ccn-droplet-count.ipynb","dependencies":[],"frontmatter":{"title":"Cloud Condensation Nuclei and Precipitation Analysis","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Max Grover","given":"Max","family":"Grover"},"name":"Max Grover","orcid":"0000-0002-0370-8974","github":"mgrover1","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/mgrover1/arm-field-site-cookbook","copyright":"2025","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"numbering":{"title":{"offset":3}},"source_url":"https://github.com/mgrover1/arm-field-site-cookbook/blob/main/projects/bnf-2025/acid/ccn-droplet-count.ipynb","edit_url":"https://github.com/mgrover1/arm-field-site-cookbook/edit/main/projects/bnf-2025/acid/ccn-droplet-count.ipynb","thumbnail":"/arm-field-site-cookbook/build/33705c75de1c0997e47bdf15c5b51f4c.jpeg","exports":[{"format":"ipynb","filename":"ccn-droplet-count.ipynb","url":"/arm-field-site-cookbook/build/ccn-droplet-count-e70c0236e7bdb3963ca1c9ee519e6b86.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"image","style":{"height":"300px"},"url":"/arm-field-site-cookbook/build/33705c75de1c0997e47bdf15c5b51f4c.jpeg","alt":"BNF Instruments","key":"x7fWzadDaC","urlSource":"https://www.arm.gov/uploads/53943128233_e595b5afeb_c.jpg"}],"key":"iOD0e8Xd5u"}],"key":"gtYEOkGnBH"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Cloud Condensation Nuclei and Precipitation Analysis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MK1j9iyTBW"}],"identifier":"cloud-condensation-nuclei-and-precipitation-analysis","label":"Cloud Condensation Nuclei and Precipitation Analysis","html_id":"cloud-condensation-nuclei-and-precipitation-analysis","implicit":true,"key":"vhtRSBYrKS"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Example shows how to plot up CCN droplet count\nin a size distribution plot, and an interactive precipitation intensity visualization.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"I64ziWJnD1"}],"key":"mAQ7GYZJwz"}],"key":"Y8CNqnitZl"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BbnLiHRfPA"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"hodoAfjkUx"}],"key":"lHe8yNjCyj"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport act\nimport matplotlib.pyplot as plt\nimport plotly.graph_objects as go","key":"KXMaXisnfU"},{"type":"output","id":"B7ARHu8ar_l-yWNwLUh5L","data":[],"key":"Ki0heOZXGq"}],"key":"IeXxrLspDU"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Analyze CCN Data for BNF from the Data Archive","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"A5jnZPn6iF"}],"identifier":"analyze-ccn-data-for-bnf-from-the-data-archive","label":"Analyze CCN Data for BNF from the Data Archive","html_id":"analyze-ccn-data-for-bnf-from-the-data-archive","implicit":true,"key":"I5sLlrXxOg"}],"key":"my7Iwrw6QM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"username = 'mgrover4'\ntoken = '176e1559b67be630'\ndatastream = 'bnfaosccn2colaspectraM1.b1'\nstartdate = '2025-05-08'\nenddate = '2025-05-11T23:59:59'","key":"XkqByeXn2L"},{"type":"output","id":"k-2eRLA5fxmWvsy5CDP1z","data":[],"key":"q6iS2IiTpX"}],"key":"qWdbDbwu5e"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Download and read the data\nresult_ccn = act.discovery.download_arm_data(username, token, datastream, startdate, enddate)\nds_ccn = act.io.read_arm_netcdf(result_ccn)\nds_ccn.clean.cleanup()","key":"AqxLVY4arl"},{"type":"output","id":"l-1KhUN99iBxti0ERWhWc","data":[{"output_type":"stream","name":"stdout","text":"[DOWNLOADING] bnfaosccn2colaspectraM1.b1.20250508.010251.nc\n"},{"output_type":"stream","name":"stdout","text":"[DOWNLOADING] bnfaosccn2colaspectraM1.b1.20250509.000954.nc\n"},{"output_type":"stream","name":"stdout","text":"[DOWNLOADING] bnfaosccn2colaspectraM1.b1.20250510.002958.nc\n"},{"output_type":"stream","name":"stdout","text":"[DOWNLOADING] bnfaosccn2colaspectraM1.b1.20250511.005002.nc\n"},{"output_type":"stream","name":"stdout","text":"\nIf you use these data to prepare a publication, please cite:\n\nKoontz, A., Uin, J., Andrews, E., Enekwizu, O., Hayes, C., & Salwen, C. Cloud\nCondensation Nuclei Particle Counter (AOSCCN2COLASPECTRA), 2025-05-08 to\n2025-05-11, Bankhead National Forest, AL, USA; Long-term Mobile Facility (BNF),\nBankhead National Forest, AL, AMF3 (Main Site) (M1). Atmospheric Radiation\nMeasurement (ARM) User Facility. https://doi.org/10.5439/1323896\n\n"},{"output_type":"stream","name":"stderr","text":"/home/runner/micromamba/envs/arm-field-site-cookbook-dev/lib/python3.11/site-packages/act/io/arm.py:155: FutureWarning: In a future version of xarray the default value for data_vars will change from data_vars='all' to data_vars=None. This is likely to lead to different results when multiple datasets have matching variables with overlapping values. To opt in to new defaults and get rid of these warnings now use `set_options(use_new_combine_kwarg_defaults=True) or set data_vars explicitly.\n  ds = xr.open_mfdataset(filenames, **kwargs)\n"}],"key":"kubbAvAxNG"}],"key":"D9XpbKaKPM"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualize the CCN Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EpoDgJnO09"}],"identifier":"visualize-the-ccn-data","label":"Visualize the CCN Data","html_id":"visualize-the-ccn-data","implicit":true,"key":"fC4k5smYK0"}],"key":"R43CqrvIH9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"if 'lat' not in ds_ccn.coords:\n    ds_ccn = ds_ccn.set_coords(['lat', 'lon'])\n\nprint(\"Variables:\", list(ds_ccn.data_vars))\n\nccn_var = 'concentration'\n\n# Plot\ndisp = act.plotting.TimeSeriesDisplay(ds_ccn, figsize=(12, 8))\ndisp.plot(ccn_var, label='CCN Concentration [#/cm³]')\ndisp.axes[0].set_title('Cloud Condensation Nuclei (CCN) Number Concentration')\ndisp.axes[0].set_ylabel('Supersaturation (%)')\ndisp.axes[0].set_xlabel('Time (UTC)')\ndisp.day_night_background()\ndisp.axes[0].legend()\n\nplt.show()","key":"fKKk9dFOhP"},{"type":"output","id":"zuP0Wl2hCbwXnJf9MoApt","data":[{"output_type":"stream","name":"stdout","text":"Variables: ['base_time', 'time_offset', 'time_bounds', 'setpoint_time', 'supersaturation_calculated', 'N_CCN', 'qc_N_CCN', 'N_CCN_fit_coefs', 'N_CCN_fit_error', 'N_CCN_fit_value', 'concentration', 'f_CCN', 'qc_f_CCN', 'alt']\n"},{"output_type":"stream","name":"stderr","text":"/tmp/ipykernel_3943/132956031.py:15: UserWarning: Legend does not support handles for QuadMesh instances.\nSee: https://matplotlib.org/stable/tutorials/intermediate/legend_guide.html#implementing-a-custom-legend-handler\n  disp.axes[0].legend()\n/tmp/ipykernel_3943/132956031.py:15: UserWarning: No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.\n  disp.axes[0].legend()\n"},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1200x800 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"0c141a4e085e2a0bdfef9c1bcba9c7eb","path":"/arm-field-site-cookbook/build/0c141a4e085e2a0bdfef9c1bcba9c7eb.png"}}}],"key":"kImZufaqBI"}],"key":"ZW0IPLsL2d"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#Get supersaturation levels and time\nsupersat = ds_ccn['supersaturation_setpoint'].values\ntimes = ds_ccn['time'].values\n\n#Create the plot\nfig, ax = plt.subplots(figsize=(12, 5))\ncolors = plt.cm.viridis(np.linspace(0, 1, len(supersat)))\n\n#Plot one trace per supersaturation level\nfor i, ss in enumerate(supersat):\n    ccn = ds_ccn['concentration'].sel(supersaturation_setpoint=ss)\n    valid = ~ccn.isnull()\n    ax.scatter(times[valid], ccn.values[valid], s=10, color=colors[i], label=f'SS = {ss:.2f}')\n\n#Plot makeup\nax.set_title('CCN Number Concentration vs Time at Different Supersaturations')\nax.set_xlabel('Time (UTC)')\nax.set_ylabel('CCN Concentration [#/cm³]')\nax.set_yscale('log')\nax.legend(title='Supersaturation (%)')\nax.grid(True)\nplt.tight_layout()\nplt.show()","key":"VzfXhw4Yjh"},{"type":"output","id":"SNwXKCp8Wa2fMt5Fg_fYZ","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1200x500 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"6a2d35628f6350d4a96d9da7eb8c42e9","path":"/arm-field-site-cookbook/build/6a2d35628f6350d4a96d9da7eb8c42e9.png"}}}],"key":"D0YGYHtVkJ"}],"key":"rph3vzJOBT"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Precipitation Analysis with the Pluvio","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AXEFZsWUy1"}],"identifier":"precipitation-analysis-with-the-pluvio","label":"Precipitation Analysis with the Pluvio","html_id":"precipitation-analysis-with-the-pluvio","implicit":true,"key":"D5Wp7HEFdf"}],"key":"LlnkVfNdI4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Set the datastream and start/enddates\ndatastream = 'bnfwbpluvio2M1.a1'\nstartdate = '2025-05-08'\nenddate = '2025-05-11T23:59:59'","key":"OMdrgWxteG"},{"type":"output","id":"i_EbB4zo4CA73lQNgAeD_","data":[],"key":"jddwoNzxBd"}],"key":"ZhhT9Qs7n3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Use ACT to easily download the data.  Watch for the data citation!  Show some support\n# for ARM's instrument experts and cite their data if you use it in a publication\nresult_rain = act.discovery.download_arm_data(username, token, datastream, startdate, enddate)\n\n# Let's read in the data using ACT and check out the data\nds_rain = act.io.read_arm_netcdf(result_rain)\n\n# Apply quality control checks\nds_rain.clean.cleanup()","key":"Ffbb17PNxk"},{"type":"output","id":"1zS5WqbSKmBjPpeQNRY9T","data":[{"output_type":"stream","name":"stdout","text":"[DOWNLOADING] bnfwbpluvio2M1.a1.20250508.000000.nc\n"},{"output_type":"stream","name":"stdout","text":"[DOWNLOADING] bnfwbpluvio2M1.a1.20250509.000000.nc\n"},{"output_type":"stream","name":"stdout","text":"[DOWNLOADING] bnfwbpluvio2M1.a1.20250510.000000.nc\n"},{"output_type":"stream","name":"stdout","text":"[DOWNLOADING] bnfwbpluvio2M1.a1.20250511.000000.nc\n"},{"output_type":"stream","name":"stdout","text":"\nIf you use these data to prepare a publication, please cite:\n\nZhu, Z., Wang, D., Jane, M., Cromwell, E., Sturm, M., Irving, K., & Delamere, J.\nWeighing Bucket Precipitation Gauge (WBPLUVIO2), 2025-05-08 to 2025-05-11,\nBankhead National Forest, AL, USA; Long-term Mobile Facility (BNF), Bankhead\nNational Forest, AL, AMF3 (Main Site) (M1). Atmospheric Radiation Measurement\n(ARM) User Facility. https://doi.org/10.5439/1338194\n\n"},{"output_type":"stream","name":"stderr","text":"/home/runner/micromamba/envs/arm-field-site-cookbook-dev/lib/python3.11/site-packages/act/io/arm.py:155: FutureWarning: In a future version of xarray the default value for data_vars will change from data_vars='all' to data_vars=None. This is likely to lead to different results when multiple datasets have matching variables with overlapping values. To opt in to new defaults and get rid of these warnings now use `set_options(use_new_combine_kwarg_defaults=True) or set data_vars explicitly.\n  ds = xr.open_mfdataset(filenames, **kwargs)\n"}],"key":"wBpH1ug3z4"}],"key":"O60HKcf9zp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#printing output label\nprint(\"Available rain-related variables:\")\n#printing list of variables\nprint(list(ds_rain.data_vars))\n#saving rain variables\nrain_rate_var = 'intensity_rt'\n#giving a shortcut\nds = ds_rain","key":"xTaYnUxWV0"},{"type":"output","id":"oazXqHUmsIV9QXRMsgBKG","data":[{"output_type":"stream","name":"stdout","text":"Available rain-related variables:\n['base_time', 'time_offset', 'intensity_rt', 'accum_rtnrt', 'accum_nrt', 'accum_total_nrt', 'bucket_rt', 'bucket_nrt', 'load_cell_temp', 'heater_status', 'pluvio_status', 'elec_unit_temp', 'supply_volts', 'orifice_temp', 'maintenance_flag', 'reset_flag', 'volt_min', 'ptemp', 'intensity_rtnrt', 'lat', 'lon', 'alt']\n"}],"key":"pD3U52H3hH"}],"key":"qKr2y2VV3H"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Interactive Visualizion of the Pluvio Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lNJuI4KN1q"}],"identifier":"interactive-visualizion-of-the-pluvio-data","label":"Interactive Visualizion of the Pluvio Data","html_id":"interactive-visualizion-of-the-pluvio-data","implicit":true,"key":"qxzfehEBiA"}],"key":"CFV8ZQtkk2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#store data\nrain_rate_var = 'intensity_rt'\ndf_rain = ds_rain[rain_rate_var].to_dataframe().dropna()\n\nfig = go.Figure()\n\nfig.add_trace(go.Scatter(\n    x=df_rain.index,\n    y=df_rain[rain_rate_var],\n    mode='lines+markers',\n    name='Rain Rate [mm/hr]',\n    line=dict(color='blue')\n))\n\nfig.update_layout(\n    title='Rain Rate (Pluvio2)',\n    xaxis_title='Time (UTC)',\n    yaxis_title='Rain Rate [mm/hr]',\n    hovermode='x unified',\n    template='plotly_white',\n    height=500,\n)\n\nfig.show()","key":"m4YkcioCh6"},{"type":"output","id":"d8CX0l2OLwEfDzNxwbcWR","data":[{"output_type":"display_data","metadata":{},"data":{"application/vnd.plotly.v1+json":{"content_type":"application/vnd.plotly.v1+json","hash":"4ed152a5122ffa00ccd27efe846f8c37","path":"/arm-field-site-cookbook/build/4ed152a5122ffa00ccd27efe846f8c37.json"}}}],"key":"FPIkys7Khh"}],"key":"Il7BnCcnjN"}],"key":"DVQsbxNnnC"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Coldpool and Downdraft Analysis","url":"/projects/bnf-2025/bnf-deep-convection/coldpool-time-series","group":"BNF Deep Convection"},"next":{"title":"Aerosol Optical Properties at BNF","url":"/projects/bnf-2025/acid/optical-properties","group":"Aerosol Cloud Interactions Deposition (ACID)"}}},"domain":"http://localhost:3000"}